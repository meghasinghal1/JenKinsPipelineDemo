name: Sast Scan Process
 
on:
  push:
    branches: [ master ]

jobs:
  sast-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Zip Repo
        shell: pwsh
        run: |
          $sourcePath = "${{ github.workspace }}"
          write-host "$sourcePath"
          $destinationPath = Split-Path -Path "$sourcePath"
          $destinationPath += "\\${{ github.event.repository.name }}-${{ github.run_number }}-${{ github.run_attempt }}.zip"
          Write-Host "$destinationPath"
          
          if(Test-Path -Path $destinationPath -PathType Leaf)
          {
              Remove-Item $destinationPath
          }
          
          Add-Type -Assembly 'System.IO.Compression.FileSystem'
          $zip = [System.IO.Compression.ZipFile]::Open($destinationPath, 'create')
          $files = [IO.Directory]::GetFiles($sourcePath, "*" , [IO.SearchOption]::AllDirectories)
          foreach($file in $files)
          {
              $relPath = $file.Substring($sourcePath.Length).TrimStart('\\').TrimStart('/').Replace("\\\\", "/").Replace("\\", "/")
              $a = [System.IO.Compression.ZipFileExtensions]::CreateEntryFromFile($zip, $file.Replace("\\\\", "/").Replace("\\", "/"), $relPath);
          }
          $zip.Dispose()

